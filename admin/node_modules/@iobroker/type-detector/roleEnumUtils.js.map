{"version":3,"file":"roleEnumUtils.js","sourceRoot":"","sources":["../src/roleEnumUtils.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright 2018-2025 bluefox <dogafox@gmail.com>\n *\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\nimport type { PatternLanguages, PatternWords } from './types';\n\nexport function checkEnum(enums: string[], words: PatternWords): boolean {\n    let found = false;\n    if (enums) {\n        enums.forEach(en => {\n            const pos = en.lastIndexOf('.');\n            if (pos !== -1) {\n                en = en.substring(pos + 1);\n            }\n            for (const lang in words) {\n                if (Object.prototype.hasOwnProperty.call(words, lang)) {\n                    if (words[lang as PatternLanguages].find(reg => reg.test(en))) {\n                        found = true;\n                        return false;\n                    }\n                }\n            }\n        });\n    }\n    return found;\n}\n\nexport function roleOrEnum(obj: ioBroker.Object, enums: string[], roles: string[], words: PatternWords): boolean {\n    if (obj.common.role && roles?.includes(obj.common.role)) {\n        return true;\n    }\n    return checkEnum(enums, words);\n}\n\n// -------------- LIGHT -----------------------------------------\nconst lightWords: PatternWords = {\n    en: [/lights?/i, /lamps?/i, /ceilings?/i],\n    de: [/licht(er)?/i, /lampen?/i, /beleuchtung(en)?/i],\n    ru: [/свет/i, /ламп[аы]/i, /торшеры?/, /подсветк[аи]/i, /лампочк[аи]/i, /светильники?/i],\n};\nconst lightRoles: string[] = ['switch.light', 'dimmer', 'value.dimmer', 'level.dimmer', 'sensor.light', 'state.light'];\nexport function roleOrEnumLight(obj: ioBroker.Object, enums: string[]): boolean {\n    return roleOrEnum(obj, enums, lightRoles, lightWords);\n}\n\n// -------------- BLINDS -----------------------------------------\nconst blindWords: PatternWords = {\n    en: [/blinds?/i, /windows?/i, /shutters?/i],\n    de: [/rollladen?/i, /fenstern?/i, /beschattung(en)?/i, /jalousien?/i],\n    ru: [/ставни/i, /рольставни/i, /окна|окно/, /жалюзи/i],\n};\n\nconst blindRoles: string[] = [\n    'blind',\n    'level.blind',\n    'value.blind',\n    'action.stop',\n    'button.stop',\n    'button.stop.blind',\n    'button.open.blind',\n    'button.close.blind',\n    'level.tilt',\n    'value.tilt',\n    'button.tilt.open',\n    'button.tilt.close',\n    'button.tilt.stop',\n];\nexport function roleOrEnumBlind(obj: ioBroker.Object, enums: string[]): boolean {\n    return roleOrEnum(obj, enums, blindRoles, blindWords);\n}\n\n// -------------- GATES ------------------------------------------\nconst gateWords: PatternWords = {\n    en: [/gates?/i],\n    de: [/^toren$/i, /^tor$/i], // \"^\" because of Actor\n    ru: [/ворота/i],\n};\n\nconst gateRoles: string[] = ['gate', 'value.gate', 'switch.gate', 'action.stop', 'button.stop'];\nexport function roleOrEnumGate(obj: ioBroker.Object, enums: string[]): boolean {\n    return roleOrEnum(obj, enums, gateRoles, gateWords);\n}\n\n// -------------- WINDOWS -----------------------------------------\nconst windowRoles: string[] = ['window', 'state.window', 'sensor.window', 'value.window'];\nexport function roleOrEnumWindow(obj: ioBroker.Object, enums: string[]): boolean {\n    return roleOrEnum(obj, enums, windowRoles, blindWords);\n}\n\n// -------------- DOORS -----------------------------------------\nconst doorsWords: PatternWords = {\n    en: [/doors?/i, /gates?/i, /wickets?/i, /entry|entries/i],\n    de: [/^türe?/i, /^tuere?/i, /^tore?$/i, /einfahrt(en)?/i, /pforten?/i], // \"^\" because of Actor\n    ru: [/двери|дверь/i, /ворота/i, /калитка|калитки/, /въезды?/i, /входы?/i],\n};\n\nconst doorsRoles: string[] = ['door', 'state.door', 'sensor.door'];\nexport function roleOrEnumDoor(obj: ioBroker.Object, enums: string[]): boolean {\n    return roleOrEnum(obj, enums, doorsRoles, doorsWords);\n}\n\nexport function getEnums(): Record<\n    'door' | 'window' | 'blind' | 'gate' | 'light',\n    { roles: string[]; words: PatternWords }\n> {\n    return {\n        door: {\n            roles: doorsRoles,\n            words: doorsWords,\n        },\n        window: {\n            roles: windowRoles,\n            words: blindWords,\n        },\n        blind: {\n            roles: blindRoles,\n            words: blindWords,\n        },\n        gate: {\n            roles: gateRoles,\n            words: gateWords,\n        },\n        light: {\n            roles: lightRoles,\n            words: lightWords,\n        },\n    };\n}\n\nexport function getAllStatesInChannel(keys: string[], channelId: string): string[] {\n    const list: string[] = [];\n    const reg = new RegExp(`^${channelId.replace(/([$^.)([\\]{}])/g, '\\\\$1')}\\\\.[^.]+$`);\n    keys.forEach(_id => reg.test(_id) && list.push(_id));\n    return list;\n}\n\nexport function getAllStatesInDevice(keys: string[], channelId: string): string[] {\n    const list: string[] = [];\n    const reg = new RegExp(`^${channelId.replace(/([$^.)([\\]{}])/g, '\\\\$1')}\\\\.[^.]+\\\\.[^.]+$`);\n    keys.forEach(_id => reg.test(_id) && list.push(_id));\n    return list;\n}\n\n/**\n * Finds all objects \"below\" a certain ID and the ID itself. It is irrelevant how many levels deep these are\n */\nexport function getObjectsBelowId(sortedKeys: string[], startId: string): string[] {\n    const list: string[] = [];\n    startId += '.';\n\n    // Find the starting index using binary search\n    let left = 0;\n    let right = sortedKeys.length - 1;\n    let startIndex = -1;\n\n    while (left <= right) {\n        const mid = Math.floor((left + right) / 2);\n        if (sortedKeys[mid] < startId) {\n            left = mid + 1;\n        } else {\n            startIndex = mid;\n            right = mid - 1;\n        }\n    }\n\n    // If no keys are >= startId, return empty array\n    if (startIndex === -1 || startIndex >= sortedKeys.length) {\n        return list;\n    }\n\n    // Iterate from startIndex, collecting keys that match or start with startId\n    for (let i = startIndex; i < sortedKeys.length; i++) {\n        const id = sortedKeys[i];\n        if (id === startId || id.startsWith(startId)) {\n            list.push(id);\n        } else {\n            // Since the keys are sorted, we can break early\n            break;\n        }\n    }\n\n    return list;\n}\n\nexport function getFunctionEnums(objects: Record<string, ioBroker.Object>, sortedKeys: string[]): string[] {\n    const enums: string[] = [];\n    const reg = /^enum\\.functions\\./;\n    const enumKeys = getObjectsBelowId(sortedKeys, 'enum');\n\n    for (const id of enumKeys) {\n        if (\n            Object.prototype.hasOwnProperty.call(objects, id) &&\n            reg.test(id) &&\n            objects[id]?.type === 'enum' &&\n            objects[id].common?.members?.length\n        ) {\n            enums.push(id);\n        }\n    }\n\n    return enums;\n}\n\nexport function getParentId(id: string): string {\n    const pos = id.lastIndexOf('.');\n    if (pos !== -1) {\n        return id.substring(0, pos);\n    }\n\n    return id;\n}\n"]}