{"version":3,"file":"i18n.js","sourceRoot":"./src/","sources":["i18n.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright 2018-2024 Denis Haev (bluefox) <dogafox@gmail.com>\n *\n * MIT License\n *\n */\n\ndeclare global {\n    interface Window {\n        sysLang: ioBroker.Languages;\n        i18nShow: (filter: string | RegExp) => void;\n        i18nDisableWarning: (disable: boolean) => void;\n    }\n}\n\ntype I18nWordDictionary = Record<ioBroker.Languages, string>;\n\ntype I18nWordsDictionary = Record<string, I18nWordDictionary>;\n\ntype I18nOneLanguageDictionary = Record<string, string>;\n\ntype I18nDictionary = {\n    [lang in ioBroker.Languages]?: I18nOneLanguageDictionary;\n};\n\ntype I18nWordsWithPrefix = I18nDictionary & { prefix?: string };\n\n/**\n * Translation string management.\n */\nexport class I18n {\n    /** List of all languages with their translations. */\n    static translations: I18nDictionary = {};\n\n    /** List of unknown translations during development. */\n    static unknownTranslations: string[] = [];\n\n    /** The currently displayed language. */\n    static lang: ioBroker.Languages = window.sysLang || 'en';\n\n    static _disableWarning: boolean = false;\n\n    /**\n     * Set the language to display\n     *\n     * @param lang The default language for translations.\n     */\n    static setLanguage(lang: ioBroker.Languages): void {\n        if (lang) {\n            I18n.lang = lang;\n        }\n    }\n\n    /**\n     * Add translations\n     * User can provide two types of structures:\n     * - {\"word1\": \"translated word1\", \"word2\": \"translated word2\"}, but in this case the lang must be provided\n     * - {\"word1\": {\"en\": \"translated en word1\", \"de\": \"translated de word1\"}, \"word2\": {\"en\": \"translated en word2\", \"de\": \"translated de word2\"}}, but no lang must be provided\n     *\n     * @param words additional words for specific language\n     * @param lang language for the words\n     */\n    static extendTranslations(\n        words: I18nWordsWithPrefix | I18nOneLanguageDictionary | I18nWordsDictionary,\n        lang?: ioBroker.Languages,\n    ): void {\n        // automatically extend all languages with prefix\n        if ((words as I18nWordsWithPrefix).prefix) {\n            const wordsWithPrefix = words as I18nWordsWithPrefix;\n            if (typeof wordsWithPrefix.prefix === 'string') {\n                const prefix = wordsWithPrefix.prefix;\n                delete wordsWithPrefix.prefix;\n                Object.keys(wordsWithPrefix).forEach(key => {\n                    const _lang = key as ioBroker.Languages;\n                    const _words: I18nOneLanguageDictionary = {};\n                    const wordsOfOneLanguage = wordsWithPrefix[_lang];\n                    Object.keys(wordsOfOneLanguage as Record<string, string>).forEach(word => {\n                        if (!word) {\n                            return;\n                        }\n                        if (wordsOfOneLanguage) {\n                            if (!word.startsWith(prefix)) {\n                                _words[`${prefix}${word}`] = wordsOfOneLanguage[word];\n                            } else {\n                                _words[word] = wordsOfOneLanguage[word];\n                            }\n                        }\n                    });\n                    words[_lang] = _words;\n                });\n            } else {\n                console.warn('Found prefix in translations, but it is not a string');\n            }\n        }\n\n        try {\n            if (!lang) {\n                // if it is a dictionary with all/many languages\n                if (words.en && words.de && words.ru) {\n                    Object.keys(words).forEach(key => {\n                        const _lang = key as ioBroker.Languages;\n                        I18n.translations[_lang] = I18n.translations[_lang] || {};\n                        const wordsOfOneLang: I18nOneLanguageDictionary | undefined = I18n.translations[_lang];\n                        Object.assign(wordsOfOneLang as Record<string, string>, words[_lang]);\n                    });\n                } else {\n                    // It could be vice versa: words.word1 = {en: 'translated word1', de: 'Ã¼bersetztes Wort2'}\n                    Object.keys(words).forEach(word => {\n                        const _word: I18nWordDictionary = (words as I18nWordsDictionary)[word];\n                        Object.keys(_word).forEach(key => {\n                            const _lang = key as ioBroker.Languages;\n                            const languageDictionary: I18nOneLanguageDictionary | undefined = I18n.translations[_lang];\n                            if (!languageDictionary) {\n                                console.warn(`Used unknown language: ${_lang}`);\n                            } else if (!languageDictionary[word]) {\n                                languageDictionary[word] = _word[_lang];\n                            } else if (languageDictionary[word] !== _word[_lang]) {\n                                console.warn(\n                                    `Translation for word \"${word}\" in \"${_lang}\" was ignored: existing = \"${languageDictionary[word]}\", new = ${_word[_lang]}`,\n                                );\n                            }\n                        });\n                    });\n                }\n            } else {\n                // translations for one language\n                if (!I18n.translations[lang]) {\n                    console.warn(`Used unknown language: ${lang}`);\n                }\n                I18n.translations[lang] = I18n.translations[lang] || {};\n                const languageDictionary: I18nOneLanguageDictionary | undefined = I18n.translations[lang];\n                if (languageDictionary) {\n                    Object.keys(words).forEach(word => {\n                        if (!languageDictionary[word]) {\n                            languageDictionary[word] = (words as I18nOneLanguageDictionary)[word];\n                        } else if (languageDictionary[word] !== (words as I18nOneLanguageDictionary)[word]) {\n                            console.warn(\n                                `Translation for word \"${word}\" in \"${lang}\" was ignored: existing = \"${languageDictionary[word]}\", new = ${(words as I18nOneLanguageDictionary)[word]}`,\n                            );\n                        }\n                    });\n                }\n            }\n        } catch (e: any) {\n            console.error(`Cannot apply translations: ${e}`);\n        }\n    }\n\n    /**\n     * Sets all translations (in all languages).\n     *\n     * @param translations The translations to add.\n     */\n    static setTranslations(translations: I18nDictionary): void {\n        if (translations) {\n            I18n.translations = translations;\n        }\n    }\n\n    /**\n     * Get the currently chosen language.\n     *\n     * @returns The current language.\n     */\n    static getLanguage(): ioBroker.Languages {\n        return I18n.lang;\n    }\n\n    /**\n     * Translate the given string to the selected language\n     *\n     * @param word The (key) word to look up the string.\n     * @param args Optional arguments which will replace the first (second, third, ...) occurrences of %s\n     */\n    static t(word: string, ...args: any[]): string {\n        const translation = I18n.translations[I18n.lang];\n        if (translation) {\n            const w = translation[word];\n            if (w) {\n                word = w;\n            } else {\n                if (!I18n.unknownTranslations.includes(word)) {\n                    I18n.unknownTranslations.push(word);\n                    !I18n._disableWarning && console.log(`Translate: ${word}`);\n                }\n                // fallback to english\n                if (I18n.lang !== 'en' && I18n.translations.en) {\n                    const wordEn = I18n.translations.en[word];\n                    if (wordEn) {\n                        word = wordEn;\n                    }\n                }\n            }\n        }\n        for (const arg of args) {\n            word = word.replace('%s', arg);\n        }\n        return word;\n    }\n\n    /**\n     * Show non-translated words\n     * Required during development\n     *\n     * @param filter The filter to apply to the list of non-translated words.\n     */\n    static i18nShow(filter?: string | RegExp): void {\n        /** List words with their translations. */\n        const result: Record<string, string> = {};\n        if (!filter) {\n            I18n.unknownTranslations.forEach(word => (result[word] = word));\n            console.log(JSON.stringify(result, null, 2));\n        } else if (typeof filter === 'string') {\n            I18n.unknownTranslations.forEach(word => {\n                if (word.startsWith(filter)) {\n                    result[word] = word.replace(filter, '');\n                }\n            });\n            console.log(JSON.stringify(result, null, 2));\n        } else if (typeof filter === 'object') {\n            I18n.unknownTranslations.forEach(word => {\n                if (filter.test(word)) {\n                    result[word] = word;\n                }\n            });\n            console.log(JSON.stringify(result, null, 2));\n        }\n    }\n\n    /**\n     * Disable warning about non-translated words\n     * Required during development\n     *\n     * @param disable Whether to disable the warning\n     */\n    static disableWarning(disable: boolean): void {\n        I18n._disableWarning = !!disable;\n    }\n}\n\n// install global handlers\nwindow.i18nShow = I18n.i18nShow;\nwindow.i18nDisableWarning = I18n.disableWarning;\n\n/*\nI18n.translations = {\n    'en': require('./i18n/en'),\n    'ru': require('./i18n/ru'),\n    'de': require('./i18n/de'),\n};\nI18n.fallbacks = true;\nI18n.t = function () {};\n*/\n"]}