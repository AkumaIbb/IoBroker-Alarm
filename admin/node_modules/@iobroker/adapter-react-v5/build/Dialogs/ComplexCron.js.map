{"version":3,"file":"ComplexCron.js","sourceRoot":"./src/","sources":["Dialogs/ComplexCron.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { type JSX } from 'react';\n\nimport { Button, DialogTitle, DialogContent, DialogActions, Dialog } from '@mui/material';\n\nimport { Check as IconOk, Cancel as IconCancel, Delete as IconClear } from '@mui/icons-material';\n\nimport { ComplexCron } from '../Components/ComplexCron';\nimport { DialogConfirm } from '../Dialogs/Confirm';\n\nimport { I18n } from '../i18n';\n\n// Generate cron expression\nconst styles: Record<string, React.CSSProperties> = {\n    headerID: {\n        fontWeight: 'bold',\n        fontStyle: 'italic',\n    },\n    radio: {\n        display: 'inline-block',\n    },\n    dialogPaper: {\n        height: 'calc(100% - 96px)',\n    },\n};\n\ninterface DialogCronProps {\n    onClose: () => void;\n    onOk: (cron: string | false) => void;\n    title?: string;\n    cron?: string;\n    cancel?: string;\n    ok?: string;\n    clear?: string;\n    clearButton?: boolean;\n}\n\ninterface DialogCronState {\n    cron: string;\n    showWarning: '' | 'everySecond' | 'everyMinute';\n}\n\nexport class DialogComplexCron extends React.Component<DialogCronProps, DialogCronState> {\n    constructor(props: DialogCronProps) {\n        super(props);\n        let cron;\n        if (this.props.cron && typeof this.props.cron === 'string' && this.props.cron.replace(/^[\"']/, '')[0] !== '{') {\n            cron = this.props.cron.replace(/['\"]/g, '').trim();\n        } else {\n            cron = this.props.cron || '{}';\n            if (typeof cron === 'string') {\n                cron = cron.replace(/^[\"']/, '').replace(/[\"']\\n?$/, '');\n            }\n        }\n\n        this.state = {\n            showWarning: '',\n            cron,\n        };\n    }\n\n    handleCancel(): void {\n        this.props.onClose();\n    }\n\n    handleOk(ignoreCheck?: boolean): void {\n        if (!ignoreCheck) {\n            // Check if the CRON will be executed every second or every minute and warn about it\n            const cron = ComplexCron.cron2state(this.state.cron);\n            if (cron.seconds === '*' || cron.seconds === '*/1') {\n                this.setState({ showWarning: 'everySecond' });\n                return;\n            }\n            if (cron.minutes === '*' || cron.minutes === '*/1') {\n                this.setState({ showWarning: 'everyMinute' });\n                return;\n            }\n        }\n\n        this.props.onOk(this.state.cron);\n        this.props.onClose();\n    }\n\n    renderWarningDialog(): JSX.Element | null {\n        if (!this.state.showWarning) {\n            return null;\n        }\n        return (\n            <DialogConfirm\n                title={I18n.t('ra_Please confirm')}\n                text={I18n.t(\n                    this.state.showWarning === 'everySecond'\n                        ? 'ra_The schedule will be executed every second. Are you sure?'\n                        : 'ra_The schedule will be executed every minute. Are you sure?',\n                )}\n                onClose={(ok: boolean) =>\n                    this.setState({ showWarning: '' }, () => {\n                        if (ok) {\n                            this.handleOk(true);\n                        }\n                    })\n                }\n            />\n        );\n    }\n\n    handleClear(): void {\n        this.props.onOk(false);\n        this.props.onClose();\n    }\n\n    render(): JSX.Element {\n        return (\n            <Dialog\n                onClose={() => {}}\n                maxWidth=\"md\"\n                fullWidth\n                sx={{ '& .MuiDialog-paper': styles.dialogPaper }}\n                open={!0}\n                aria-labelledby=\"cron-dialog-title\"\n            >\n                {this.renderWarningDialog()}\n                <DialogTitle id=\"cron-dialog-title\">{this.props.title || I18n.t('ra_Define schedule...')}</DialogTitle>\n                <DialogContent style={{ height: '100%', overflow: 'hidden' }}>\n                    <ComplexCron\n                        cronExpression={this.state.cron}\n                        onChange={cron => this.setState({ cron })}\n                        language={I18n.getLanguage()}\n                    />\n                </DialogContent>\n                <DialogActions>\n                    {!!this.props.clearButton && (\n                        <Button\n                            color=\"grey\"\n                            variant=\"contained\"\n                            onClick={() => this.handleClear()}\n                            startIcon={<IconClear />}\n                        >\n                            {this.props.clear || I18n.t('ra_Clear')}\n                        </Button>\n                    )}\n                    <Button\n                        variant=\"contained\"\n                        onClick={() => this.handleOk()}\n                        color=\"primary\"\n                        startIcon={<IconOk />}\n                    >\n                        {this.props.ok || I18n.t('ra_Ok')}\n                    </Button>\n                    <Button\n                        color=\"grey\"\n                        variant=\"contained\"\n                        onClick={() => this.handleCancel()}\n                        startIcon={<IconCancel />}\n                    >\n                        {this.props.cancel || I18n.t('ra_Cancel')}\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n"]}