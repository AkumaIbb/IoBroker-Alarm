{"version":3,"file":"SelectFile.js","sourceRoot":"./src/","sources":["Dialogs/SelectFile.tsx"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2022-2025 Denis Haev (bluefox) <dogafox@gmail.com>\n *\n * MIT License\n *\n */\nimport React, { type JSX } from 'react';\n\nimport { Button, DialogTitle, DialogContent, DialogActions, Dialog } from '@mui/material';\n\nimport { Cancel as IconCancel, Check as IconOk } from '@mui/icons-material';\n\nimport type { Connection } from '@iobroker/socket-client';\n\nimport { I18n } from '../i18n';\nimport { FileBrowser } from '../Components/FileBrowser';\nimport type { IobTheme } from '../types';\n\nconst styles: Record<string, React.CSSProperties> = {\n    headerID: {\n        fontWeight: 'bold',\n        fontStyle: 'italic',\n    },\n    dialog: {\n        height: '95%',\n    },\n    dialogMobile: {\n        // it is sx\n        padding: '4px',\n        width: '100%',\n        maxWidth: '100%',\n        maxHeight: 'calc(100% - 16px)',\n        height: '100%',\n    },\n    content: {\n        height: '100%',\n        overflow: 'hidden',\n    },\n    contentMobile: {\n        padding: '8px 4px',\n    },\n    titleRoot: {\n        whiteSpace: 'nowrap',\n        width: 'calc(100% - 72px)',\n        overflow: 'hidden',\n        display: 'inline-block',\n        textOverflow: 'ellipsis',\n    },\n};\n\ninterface DialogSelectFileProps {\n    /** where to store settings in localStorage * @property {string} [title] The dialog title; default: Please select object ID... (translated) */\n    dialogName?: string;\n    /** The dialog title; default: Please select object ID... (translated) */\n    title?: string;\n    /** Set to true to allow the selection of multiple IDs. */\n    multiSelect?: boolean;\n    /** Image prefix. Normally, admin has '../..' and the web has '../' */\n    imagePrefix?: string; // Prefix (default: '.')\n    /** @deprecated Image prefix */\n    prefix?: string;\n    /** Show the expert button? */\n    showExpertButton?: boolean;\n    /** Language */\n    lang?: ioBroker.Languages;\n    /** Socket class */\n    socket: Connection;\n    /** Theme name. */\n    themeName?: string;\n    /** Theme type. */\n    themeType?: 'dark' | 'light';\n    /** Theme object. */\n    theme: IobTheme;\n    /** The selected IDs. */\n    selected?: string | string[];\n    /** The ok button text; default: OK (translated) */\n    ok?: string;\n    /** The cancel button text; default: Cancel (translated) */\n    cancel?: string;\n    /** If download of files enabled */\n    allowUpload?: boolean;\n    /** If download of files enabled */\n    allowDownload?: boolean;\n    /** If creation of folders enabled */\n    allowCreateFolder?: boolean;\n    /** If creation of folders enabled */\n    allowDelete?: boolean;\n    /** if tile view enabled (default true) */\n    allowView?: boolean;\n    /** Show toolbar (default true) */\n    showToolbar?: boolean;\n    /** Limit file browser to one specific objectID of type meta and the following path (like vis.0/main) */\n    limitPath?: string;\n    /** like `['png', 'svg', 'bmp', 'jpg', 'jpeg', 'gif']` */\n    filterFiles?: string[];\n    /** images, code, txt, audio, video */\n    filterByType?: 'images' | 'code' | 'txt';\n    /** allow only folder's selection */\n    selectOnlyFolders?: boolean;\n    /** Close handler that is always called when the dialog is closed. */\n    onClose: () => void;\n    /** Handler that is called when the user presses OK or by double click. */\n    onOk: (selected: string | string[] | undefined) => void;\n    /** The styling class names. */\n    filters?: Record<string, string>;\n    /** Allow switch views Table<=>Rows */\n    showViewTypeButton?: boolean;\n    /** If type selector should be shown */\n    showTypeSelector?: boolean;\n    /** If defined, allow selecting only files from this folder */\n    restrictToFolder?: string;\n    /** If restrictToFolder defined, allow selecting files outside of this folder */\n    allowNonRestricted?: boolean;\n    /** force expert mode */\n    expertMode?: boolean;\n    /** Translate function - optional */\n    t?: (text: string, ...args: any[]) => string;\n    /** The z-index of the dialog; default: 1300 */\n    zIndex?: number;\n}\n\ninterface DialogSelectFileState {\n    selected: string[];\n}\n\nexport class DialogSelectFile extends React.Component<DialogSelectFileProps, DialogSelectFileState> {\n    private readonly dialogName: string;\n\n    private readonly filters: Record<string, string>;\n\n    constructor(props: DialogSelectFileProps) {\n        super(props);\n        this.dialogName = this.props.dialogName || 'default';\n        this.dialogName = `SelectFile.${this.dialogName}`;\n\n        const filters: string = ((window as any)._localStorage || window.localStorage).getItem(this.dialogName) || '{}';\n\n        try {\n            this.filters = JSON.parse(filters);\n        } catch {\n            this.filters = {};\n        }\n\n        if (props.filters) {\n            this.filters = { ...this.filters, ...props.filters };\n        }\n\n        let selected = this.props.selected || [];\n        if (typeof selected !== 'object') {\n            selected = [selected];\n        } else {\n            selected = [...selected];\n        }\n        selected = selected.filter(id => id);\n\n        this.state = {\n            selected,\n        };\n    }\n\n    handleCancel(): void {\n        this.props.onClose();\n    }\n\n    handleOk(): void {\n        this.props.onOk(\n            this.props.multiSelect || !Array.isArray(this.state.selected)\n                ? this.state.selected\n                : this.state.selected[0] || '',\n        );\n        this.props.onClose();\n    }\n\n    render(): JSX.Element {\n        let title;\n        if (this.state.selected.length) {\n            if (!Array.isArray(this.state.selected) || this.state.selected.length === 1) {\n                title = [\n                    <span key=\"selected\">\n                        {I18n.t('ra_Selected')}\n                        &nbsp;\n                    </span>,\n                    <span\n                        key=\"id\"\n                        style={styles.headerID}\n                    >\n                        {this.state.selected}\n                    </span>,\n                ];\n            } else {\n                title = [\n                    <span key=\"selected\">\n                        {I18n.t('ra_Selected')}\n                        &nbsp;\n                    </span>,\n                    <span\n                        key=\"id\"\n                        style={styles.headerID}\n                    >\n                        {I18n.t('%s items', this.state.selected.length)}\n                    </span>,\n                ];\n            }\n        } else {\n            title = this.props.title || I18n.t('ra_Please select file...');\n        }\n\n        return (\n            <Dialog\n                onClose={() => {}}\n                maxWidth={false}\n                style={{ zIndex: this.props.zIndex || undefined }}\n                sx={{ '& .MuiDialog-paper': { ...styles.dialog, ...styles.dialogMobile } }}\n                fullWidth\n                open={!0}\n                aria-labelledby=\"ar_dialog_selectfile_title\"\n            >\n                <DialogTitle\n                    id=\"ar_dialog_selectfile_title\"\n                    sx={{ '&.MuiDialogTitle-root': styles.titleRoot }}\n                >\n                    {title}\n                </DialogTitle>\n                <DialogContent style={{ ...styles.content, ...styles.contentMobile }}>\n                    <FileBrowser\n                        ready\n                        imagePrefix={this.props.imagePrefix || this.props.prefix || '../'} // prefix is for back compatibility\n                        allowUpload={!!this.props.allowUpload}\n                        allowDownload={this.props.allowDownload !== false}\n                        allowCreateFolder={!!this.props.allowCreateFolder}\n                        allowDelete={!!this.props.allowDelete}\n                        allowView={this.props.allowView !== false}\n                        showViewTypeButton={this.props.showViewTypeButton !== false}\n                        showToolbar={this.props.showToolbar !== false}\n                        limitPath={this.props.limitPath}\n                        filterFiles={this.props.filterFiles}\n                        filterByType={this.props.filterByType}\n                        selected={this.props.selected}\n                        restrictToFolder={this.props.restrictToFolder}\n                        allowNonRestricted={this.props.allowNonRestricted}\n                        onSelect={(selected: string | string[], isDoubleClick?: boolean, isFolder?: boolean) => {\n                            this.setState(\n                                { selected: Array.isArray(selected) ? selected : [selected] },\n                                () => isDoubleClick && (!this.props.selectOnlyFolders || isFolder) && this.handleOk(),\n                            );\n                        }}\n                        t={this.props.t || I18n.t}\n                        lang={this.props.lang || I18n.getLanguage()}\n                        socket={this.props.socket}\n                        themeType={this.props.themeType}\n                        themeName={this.props.themeName}\n                        theme={this.props.theme}\n                        showExpertButton={this.props.showExpertButton}\n                        expertMode={this.props.expertMode}\n                        showTypeSelector={this.props.showTypeSelector}\n                    />\n                </DialogContent>\n                <DialogActions>\n                    <Button\n                        variant=\"contained\"\n                        onClick={() => this.handleOk()}\n                        startIcon={<IconOk />}\n                        disabled={!this.state.selected.length}\n                        color=\"primary\"\n                    >\n                        {this.props.ok || I18n.t('ra_Ok')}\n                    </Button>\n                    <Button\n                        color=\"grey\"\n                        variant=\"contained\"\n                        onClick={() => this.handleCancel()}\n                        startIcon={<IconCancel />}\n                    >\n                        {this.props.cancel || I18n.t('ra_Cancel')}\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n"]}