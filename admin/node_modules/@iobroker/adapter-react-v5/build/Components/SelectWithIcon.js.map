{"version":3,"file":"SelectWithIcon.js","sourceRoot":"./src/","sources":["Components/SelectWithIcon.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,EAAE,SAAS,EAAE,MAAM,OAAO,CAAC;AAEzC,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAK1E,OAAO,EAAE,IAAI,EAAE,MAAM,QAAQ,CAAC;AAC9B,OAAO,EAAE,KAAK,EAAE,MAAM,SAAS,CAAC;AAChC,OAAO,EAAE,IAAI,EAAE,MAAM,SAAS,CAAC;AAE/B,MAAM,MAAM,GAAwC;IAChD,SAAS,EAAE;QACP,OAAO,EAAE,GAAG;KACf;IACD,IAAI,EAAE;QACF,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;QACV,WAAW,EAAE,CAAC;KACjB;CACJ,CAAC;AAgCF,MAAM,OAAO,cAAe,SAAQ,SAAmD;IAClE,aAAa,CAAqB;IAE3C,OAAO,GAAyC,IAAI,CAAC;IAE7D,YAAY,KAA0B;QAClC,KAAK,CAAC,KAAK,CAAC,CAAC;QAEb,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC;YAClB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC;QACrD,CAAC;QAED,IAAI,IAAwB,CAAC;QAC7B,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC;YAC5B,IAAI,GAAG,KAAK,CAAC,IAAI;iBACZ,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC;iBACrC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBACT,IAAI,EAAE,KAAK,CAAC,oBAAoB,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC;qBAC5C,OAAO,CAAC,eAAe,EAAE,EAAE,CAAC;qBAC5B,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;qBAC3B,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;qBAC1B,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC;gBACnC,KAAK,EAAE,GAAG,CAAC,GAAG;gBACd,IAAI,EAAE,GAAG,CAAC,MAAM,EAAE,IAAI;gBACtB,KAAK,EAAE,GAAG,CAAC,MAAM,EAAE,KAAK;aAC3B,CAAC,CAAC,CAAC;QACZ,CAAC;aAAM,CAAC;YACJ,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC;iBAC3B,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC;iBACrC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBACT,IAAI,EAAE,KAAK,CAAC,oBAAoB,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC;qBAC5C,OAAO,CAAC,eAAe,EAAE,EAAE,CAAC;qBAC5B,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;qBAC3B,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;qBAC1B,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC;gBACnC,KAAK,EAAE,GAAG,CAAC,GAAG;gBACd,IAAI,EAAE,GAAG,CAAC,MAAM,EAAE,IAAI;gBACtB,KAAK,EAAE,GAAG,CAAC,MAAM,EAAE,KAAK;aAC3B,CAAC,CAAC,CAAC;QACZ,CAAC;QAED,IAAI,KAAK,CAAC,SAAS,IAAI,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,SAAS,EAAE,CAAC;YACrD,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,aAAa,IAAI,EAAE,EAAE,CAAC,CAAC;QAC7E,CAAC;QAED,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC;YAClB,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QACzD,CAAC;QAED,IAAI,CAAC,KAAK,GAAG;YACT,IAAI;SACP,CAAC;IACN,CAAC;IAED,MAAM;QACF,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE,CAAC,EAAE,CAAC;YACzE,IAAI,CAAC,OAAO;gBACR,IAAI,CAAC,OAAO;oBACZ,UAAU,CAAC,GAAG,EAAE;wBACZ,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;wBACpB,MAAM,IAAI,GAAuB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;wBAC7E,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;wBACrD,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;oBAC5B,CAAC,EAAE,GAAG,CAAC,CAAC;QAChB,CAAC;aAAM,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE,CAAC,EAAE,CAAC;YAChF,IAAI,CAAC,OAAO;gBACR,IAAI,CAAC,OAAO;oBACZ,UAAU,CAAC,GAAG,EAAE;wBACZ,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;wBACpB,MAAM,IAAI,GAAuB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;wBAC7E,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE,CAAC,CAAC;wBAC7D,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBAClB,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;oBAC5B,CAAC,EAAE,GAAG,CAAC,CAAC;QAChB,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAC7B,EAAE,CAAC,EAAE,CACD,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK;YAC7B,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,IAAI,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CACtG,CAAC;QAEF,MAAM,KAAK,GACP,IAAI,CAAC,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS;YACrC,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC;gBACI,KAAK,EAAE,IAAI,EAAE,KAAK,IAAI,SAAS;gBAC/B,eAAe,EAAE,KAAK,CAAC,gBAAgB,CAAC,IAAI,EAAE,KAAK,IAAI,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;aACnF,CAAC;QAEZ,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YACvC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC3C,CAAC;QAED,MAAM,MAAM,GAAG,CACX,oBAAC,MAAM,IACH,OAAO,EAAC,UAAU,EAClB,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAC7B,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,EACvB,SAAS,EAAE;gBACP,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;aAC/B,EACD,WAAW,EACP,EAAC,WAAW,EAAE,EAAE,CAAC,CACb;gBACK,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CACV,oBAAC,IAAI,IACD,GAAG,EAAE,IAAI,EAAE,IAAI,EACf,KAAK,EAAE,MAAM,CAAC,IAAI,GACpB,CACL,CAAC,CAAC,CAAC,IAAI;gBACP,IAAI,EAAE,IAAI,CACR,CACV,EAEL,EAAE,EAAE;gBACA,kBAAkB,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;aACxF,EACD,OAAO,EAAE;gBACL,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;aACrD,EACD,KAAK,EAAE,KAAK,EACZ,QAAQ,EAAE,EAAE,CAAC,EAAE;gBACX,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,EAAE,CAAC,MAAM,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;oBACnE,IAAI,GAAG,GAAG,IAAI,CAAC;oBACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;wBAC9C,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;4BACpD,GAAG,GAAG,CAAC,CAAC;4BACR,MAAM;wBACV,CAAC;oBACL,CAAC;oBACD,IAAI,GAAG,KAAK,IAAI,EAAE,CAAC;wBACf,MAAM,IAAI,GAAuB,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAuB,CAAC;wBACpF,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;wBACpB,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;wBACpE,OAAO;oBACX,CAAC;gBACL,CAAC;gBAED,IAAI,CAAC,KAAK,CAAC,QAAQ,CACf,IAAI,CAAC,KAAK,CAAC,YAAY;oBACnB,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC;oBACtD,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CACxB,CAAC;YACN,CAAC,IAEA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CACvB,oBAAC,QAAQ,IACL,KAAK,EACD,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS;gBACrD,CAAC,CAAC,MAAM,CAAC,SAAS;gBAClB,CAAC,CAAC;oBACI,KAAK,EAAE,EAAE,CAAC,KAAK,IAAI,SAAS;oBAC5B,eAAe,EAAE,KAAK,CAAC,gBAAgB,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;iBAChF,EAEX,GAAG,EAAE,EAAE,CAAC,KAAK,EACb,KAAK,EAAE,EAAE,CAAC,KAAK;YAEd,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CACP,oBAAC,IAAI,IACD,GAAG,EAAE,EAAE,CAAC,IAAI,EACZ,KAAK,EAAE,MAAM,CAAC,IAAI,GACpB,CACL,CAAC,CAAC,CAAC,IAAI;YACP,EAAE,CAAC,IAAI,CACD,CACd,CAAC,CACG,CACZ,CAAC;QAEF,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YACnB,OAAO,MAAM,CAAC;QAClB,CAAC;QAED,OAAO,CACH,oBAAC,WAAW,IACR,OAAO,EAAC,UAAU,EAClB,SAAS,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EACjC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,EACvB,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS;YAE/B,oBAAC,UAAU,QAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAc;YAC1C,MAAM,CACG,CACjB,CAAC;IACN,CAAC;CACJ","sourcesContent":["import React, { Component } from 'react';\n\nimport { FormControl, InputLabel, MenuItem, Select } from '@mui/material';\nimport type { InputProps } from '@mui/material/Input';\n\nimport type { ThemeType, Translate } from '../types';\n\nimport { Icon } from './Icon';\nimport { Utils } from './Utils';\nimport { I18n } from '../i18n';\n\nconst styles: Record<string, React.CSSProperties> = {\n    different: {\n        opacity: 0.5,\n    },\n    icon: {\n        width: 16,\n        height: 16,\n        marginRight: 8,\n    },\n};\n\ninterface SelectWithIconProps {\n    t: Translate;\n    lang: ioBroker.Languages;\n    themeType: ThemeType;\n    value?: string;\n    onChange: (id: string) => void;\n    disabled?: boolean;\n    list?: ioBroker.Object[] | Record<string, ioBroker.Object>; // one of \"list\"(Array) or \"options\"(object) is required\n    different?: string | boolean;\n    label?: string;\n    fullWidth?: boolean;\n    className?: string;\n    style?: React.CSSProperties;\n    removePrefix?: string;\n    allowNone?: boolean;\n    inputProps?: InputProps['inputProps'];\n    dense?: boolean;\n}\n\ninterface TextWithIconItem {\n    name: string;\n    value: string;\n    icon?: string;\n    color?: string;\n}\n\ninterface SelectWithIconState {\n    list: TextWithIconItem[];\n}\n\nexport class SelectWithIcon extends Component<SelectWithIconProps, SelectWithIconState> {\n    private readonly wordDifferent: string | undefined;\n\n    private timeout: ReturnType<typeof setTimeout> | null = null;\n\n    constructor(props: SelectWithIconProps) {\n        super(props);\n\n        if (props.different) {\n            this.wordDifferent = props.t('ra___different__');\n        }\n\n        let list: TextWithIconItem[];\n        if (Array.isArray(props.list)) {\n            list = props.list\n                .filter(obj => obj?._id && obj.common)\n                .map(obj => ({\n                    name: Utils.getObjectNameFromObj(obj, props.lang)\n                        .replace('system.group.', '')\n                        .replace('system.user.', '')\n                        .replace('enum.rooms.', '')\n                        .replace('enum.functions.', ''),\n                    value: obj._id,\n                    icon: obj.common?.icon,\n                    color: obj.common?.color,\n                }));\n        } else {\n            list = Object.values(props.list)\n                .filter(obj => obj?._id && obj.common)\n                .map(obj => ({\n                    name: Utils.getObjectNameFromObj(obj, props.lang)\n                        .replace('system.group.', '')\n                        .replace('system.user.', '')\n                        .replace('enum.rooms.', '')\n                        .replace('enum.functions.', ''),\n                    value: obj._id,\n                    icon: obj.common?.icon,\n                    color: obj.common?.color,\n                }));\n        }\n\n        if (props.different && props.value === props.different) {\n            list.unshift({ value: props.different, name: this.wordDifferent || '' });\n        }\n\n        if (props.allowNone) {\n            list.unshift({ value: '', name: I18n.t('ra_none') });\n        }\n\n        this.state = {\n            list,\n        };\n    }\n\n    render(): React.JSX.Element {\n        if (this.props.allowNone && !this.state.list.find(obj => obj.value === '')) {\n            this.timeout =\n                this.timeout ||\n                setTimeout(() => {\n                    this.timeout = null;\n                    const list: TextWithIconItem[] = JSON.parse(JSON.stringify(this.state.list));\n                    list.unshift({ value: '', name: I18n.t('ra_none') });\n                    this.setState({ list });\n                }, 100);\n        } else if (!this.props.allowNone && this.state.list.find(obj => obj.value === '')) {\n            this.timeout =\n                this.timeout ||\n                setTimeout(() => {\n                    this.timeout = null;\n                    const list: TextWithIconItem[] = JSON.parse(JSON.stringify(this.state.list));\n                    const i = this.state.list.findIndex(obj => obj.value === '');\n                    list.splice(i, 1);\n                    this.setState({ list });\n                }, 100);\n        }\n\n        const item = this.state.list.find(\n            it =>\n                it.value === this.props.value ||\n                (this.props.removePrefix && it.value.replace(this.props.removePrefix, '') === this.props.value),\n        );\n\n        const style =\n            this.props.value === this.props.different\n                ? {}\n                : {\n                      color: item?.color || undefined,\n                      backgroundColor: Utils.getInvertedColor(item?.color || '', this.props.themeType),\n                  };\n\n        if (this.props.dense && this.props.style) {\n            Object.assign(style, this.props.style);\n        }\n\n        const select = (\n            <Select\n                variant=\"standard\"\n                disabled={this.props.disabled}\n                value={this.props.value}\n                slotProps={{\n                    input: this.props.inputProps,\n                }}\n                renderValue={\n                    (/* value */) => (\n                        <span>\n                            {item?.icon ? (\n                                <Icon\n                                    src={item?.icon}\n                                    style={styles.icon}\n                                />\n                            ) : null}\n                            {item?.name}\n                        </span>\n                    )\n                }\n                sx={{\n                    '&.MuiSelect-root': this.props.value === this.props.different ? styles.different : {},\n                }}\n                classes={{\n                    root: this.props.dense ? this.props.className : '',\n                }}\n                style={style}\n                onChange={el => {\n                    if (this.props.different && el.target.value !== this.props.different) {\n                        let pos = null;\n                        for (let i = 0; i < this.state.list.length; i++) {\n                            if (this.state.list[i].value === this.props.different) {\n                                pos = i;\n                                break;\n                            }\n                        }\n                        if (pos !== null) {\n                            const list: TextWithIconItem[] = Utils.clone(this.state.list) as TextWithIconItem[];\n                            list.splice(pos, 1);\n                            this.setState({ list }, () => this.props.onChange(el.target.value));\n                            return;\n                        }\n                    }\n\n                    this.props.onChange(\n                        this.props.removePrefix\n                            ? el.target.value.replace(this.props.removePrefix, '')\n                            : el.target.value,\n                    );\n                }}\n            >\n                {this.state.list.map(el => (\n                    <MenuItem\n                        style={\n                            this.props.different && el.value === this.props.different\n                                ? styles.different\n                                : {\n                                      color: el.color || undefined,\n                                      backgroundColor: Utils.getInvertedColor(el.color || '', this.props.themeType),\n                                  }\n                        }\n                        key={el.value}\n                        value={el.value}\n                    >\n                        {el.icon ? (\n                            <Icon\n                                src={el.icon}\n                                style={styles.icon}\n                            />\n                        ) : null}\n                        {el.name}\n                    </MenuItem>\n                ))}\n            </Select>\n        );\n\n        if (this.props.dense) {\n            return select;\n        }\n\n        return (\n            <FormControl\n                variant=\"standard\"\n                fullWidth={!!this.props.fullWidth}\n                style={this.props.style}\n                className={this.props.className}\n            >\n                <InputLabel>{this.props.label}</InputLabel>\n                {select}\n            </FormControl>\n        );\n    }\n}\n"]}