{"version":3,"file":"SocketEvents.js","sourceRoot":"","sources":["../../src/SocketEvents.ts"],"names":[],"mappings":"","sourcesContent":["import type { ERRORS, SocketACL } from './Connection.js';\nimport type { LogMessage } from './ConnectionProps.js';\n\n/** Defines which events are emitted by the server and can be listened on the client */\nexport interface IOListenEvents {\n    objectChange: (id: string, obj: ioBroker.Object) => void;\n    stateChange: (id: string, obj: ioBroker.State) => void;\n    fileChange: (id: string, fileName: string, size: number | null) => void;\n    cmdStdout: (id: string, text: string) => void;\n    cmdStderr: (id: string, text: string) => void;\n    cmdExit: (id: string, exitCode: number) => void;\n    im: (messageType: string, from: string, data: any) => void; // message from instance\n\n    connect: (noTimeout: boolean) => void;\n    reconnect: () => void;\n    disconnect: () => void;\n    reauthenticate: () => void;\n\n    log: (message: LogMessage) => void;\n\n    error: (error: Error) => void;\n    connect_error: (error: Error) => void;\n    permissionError: (error: any) => void; // TODO: check ioBroker.admin/lib/socket.js for the shape of this\n}\n\nexport type GenericCallback<T> = ErrorAsString<ioBroker.GenericCallback<T>>;\nexport type ErrorCallback = ErrorAsString<ioBroker.ErrorCallback>;\n\nexport type AuthenticateCallback = (isOk: boolean, isSecure: boolean) => void;\nexport type AuthEnabledCallback = (isSecure: boolean, user: string) => void;\nexport type GetUserPermissionsCallback = (err?: string, acl?: SocketACL | null) => void;\nexport type SubscribeOnInstanceCallback = (\n    error: string | null,\n    result?: { error?: string; accepted?: boolean; heartbeat?: number },\n) => void;\nexport type UnsubscribeFromInstanceCallback = (err: string | null, wasSubscribed: boolean) => void;\n\nexport type ErrorAsString<T extends (...args: any[]) => void> = T extends (err: Error | null, ...args: infer U) => void\n    ? (err: string | null | undefined, ...args: U) => void\n    : T extends (err?: Error | null, ...args: infer U) => void\n      ? (err: string | null | undefined, ...args: U) => void\n      : never;\n\nexport type GetBinaryStateCallback = (err?: string | null, stateBase64?: string) => void;\nexport type ReadFile64Callback = (err?: string | null, file?: string) => void;\n\nexport type GetVersionCallback = (err?: string | null, version?: string, serverName?: string) => void;\n\nexport type GetAdapterNameCallback = (err?: string | null, serverName?: string) => void;\n\nexport type GetHostByIPCallback = (ip: string, host: ioBroker.HostObject) => void;\n\nexport type GenericCallbackNoExtraError<T> = (result?: ERRORS.PERMISSION_ERROR | T) => void;\n\nexport interface DelObjectOptions {\n    maintenance?: boolean;\n    user?: string;\n}\n\nexport interface DelObjectsOptions extends DelObjectOptions {\n    recursive?: boolean;\n}\n\nexport interface CompactInstanceInfo {\n    adminTab: ioBroker.AdapterCommon['adminTab'];\n    name: ioBroker.InstanceCommon['name'];\n    icon: ioBroker.InstanceCommon['icon'];\n    enabled: ioBroker.InstanceCommon['enabled'];\n    version: ioBroker.InstanceCommon['version'];\n}\n\nexport interface CompactAdapterInfo {\n    icon: ioBroker.AdapterCommon['icon'];\n    v: ioBroker.AdapterCommon['version'];\n    iv?: ioBroker.AdapterCommon['ignoreVersion'];\n}\n\nexport type CompactInstalledInfo = Record<\n    string,\n    {\n        version: string;\n    }\n>;\n\nexport type CompactRepository = Record<\n    string,\n    {\n        icon: ioBroker.AdapterCommon['icon'];\n        version: string;\n    }\n>;\n\nexport type CompactHost = {\n    _id: ioBroker.HostObject['_id'];\n    common: {\n        name: ioBroker.HostCommon['name'];\n        icon: ioBroker.HostCommon['icon'];\n        color: string;\n        installedVersion: ioBroker.HostCommon['installedVersion'];\n    };\n    native: {\n        hardware: {\n            networkInterfaces?: ioBroker.HostNative['hardware']['networkInterfaces'];\n        };\n    };\n};\nexport type CompactSystemRepositoryEntry = {\n    link: string;\n    hash?: string;\n    stable?: boolean;\n    json:\n        | {\n              _repoInfo: {\n                  stable?: boolean;\n                  name?: ioBroker.StringOrTranslated;\n              };\n          }\n        | null\n        | undefined;\n};\n\nexport type CompactSystemRepository = {\n    _id: ioBroker.HostObject['_id'];\n    common: {\n        name: ioBroker.HostCommon['name'];\n        dontDelete: boolean;\n    };\n    native: {\n        repositories: Record<string, CompactSystemRepositoryEntry>;\n    };\n};\n\nexport interface LogFile {\n    fileName: string;\n    size: number;\n}\n\nexport interface License {\n    id: string;\n    product: string;\n    time: number;\n    uuid: string;\n    validTill: string;\n    version: string;\n    usedBy: string;\n    invoice: string;\n    json: string;\n}\n\n/** Defines which events are emitted by the client and can be listened on the server */\nexport interface IOEmitEvents {\n    authenticate(callback: AuthenticateCallback): void;\n    authEnabled(callback: AuthEnabledCallback): void;\n    getUserPermissions(callback?: GetUserPermissionsCallback): void;\n    updateTokenExpiration(accessToken: string, callback?: (err: string | null, success?: boolean) => void): void;\n\n    requireLog(enabled: boolean, callback?: ErrorCallback): void;\n\n    subscribe(pattern: string | string[], callback?: ErrorCallback): void;\n    unsubscribe(pattern: string | string[], callback?: ErrorCallback): void;\n    subscribeObjects(pattern: string | string[], callback?: ErrorCallback): void;\n    unsubscribeObjects(pattern: string | string[], callback?: ErrorCallback): void;\n    subscribeFiles(id: string, filePattern: string | string[], callback?: ErrorCallback): void;\n    unsubscribeFiles(id: string, filePattern: string | string[], callback?: ErrorCallback): void;\n\n    getObjects(callback?: ErrorAsString<ioBroker.GetObjectsCallback>): void;\n    getObjects(list: string[], callback?: ErrorAsString<ioBroker.GetObjectsCallback>): void;\n    getAllObjects(callback?: ErrorAsString<ioBroker.GetObjectsCallback>): void;\n    getObjectView<Design extends string = string, Search extends string = string>(\n        design: Design,\n        search: Search,\n        params: ioBroker.GetObjectViewParams | null | undefined,\n        callback: ErrorAsString<ioBroker.GetObjectViewCallback<ioBroker.InferGetObjectViewItemType<Design, Search>>>,\n    ): void;\n\n    delObject:\n        | ((id: string, options: DelObjectOptions, callback?: ErrorAsString<ioBroker.GetObjectsCallback>) => void)\n        | ((id: string, callback?: ErrorAsString<ioBroker.GetObjectsCallback>) => void);\n    delObjects:\n        | ((id: string, options: DelObjectsOptions, callback?: ErrorAsString<ioBroker.GetObjectsCallback>) => void)\n        | ((id: string, callback?: ErrorAsString<ioBroker.GetObjectsCallback>) => void);\n    setObject(id: string, val: ioBroker.SettableObject, callback?: ErrorCallback): void;\n    extendObject(\n        id: string,\n        objPart: ioBroker.PartialObject,\n        callback?: ErrorAsString<ioBroker.SetObjectCallback>,\n    ): void;\n    getObject(id: string, callback?: ErrorAsString<ioBroker.GetObjectCallback>): void;\n    getForeignObjects:\n        | ((pattern: string, type: ioBroker.ObjectType, callback: ErrorAsString<ioBroker.GetObjectsCallback>) => void)\n        | ((pattern: string, callback: ErrorAsString<ioBroker.GetObjectsCallback>) => void);\n\n    getStates(pattern?: string | string[], callback?: ErrorAsString<ioBroker.GetStatesCallback>): void;\n\n    getForeignStates(\n        pattern: string | string[] | null | undefined,\n        callback?: ErrorAsString<ioBroker.GetStatesCallback>,\n    ): void;\n\n    getState(id: string, callback?: ErrorAsString<ioBroker.GetStateCallback>): void;\n    getBinaryState(id: string, callback?: GetBinaryStateCallback): void;\n\n    setState(\n        id: string,\n        val: ioBroker.State | ioBroker.StateValue | ioBroker.SettableState,\n        callback?: ErrorCallback,\n    ): void;\n    setBinaryState(id: string, base64: string, callback?: ErrorCallback): void;\n\n    readDir(adapterName: string | null, path: string, callback: ErrorAsString<ioBroker.ReadDirCallback>): void;\n    readFile(adapterName: string | null, path: string, callback: ErrorAsString<ioBroker.ReadFileCallback>): void;\n    readFile64(adapterName: string | null, path: string, callback: ReadFile64Callback): void;\n    writeFile(adapterName: string | null, path: string, data: string, callback: ErrorCallback): void;\n    writeFile64(adapterName: string | null, path: string, dataBase64: string, callback: ErrorCallback): void;\n    deleteFile(adapterName: string | null, path: string, callback: ErrorCallback): void;\n    deleteFolder(adapterName: string | null, path: string, callback: ErrorCallback): void;\n    fileExists(adapterName: string | null, path: string, callback: GenericCallback<boolean>): void;\n    renameFile(adapterName: string | null, oldFile: string, newFile: string, callback: ErrorCallback): void;\n    rename(adapterName: string | null, oldFile: string, newFile: string, callback: ErrorCallback): void;\n\n    getHistory(\n        id: string,\n        options: ioBroker.GetHistoryOptions,\n        callback: ErrorAsString<ioBroker.GetHistoryCallback>,\n    ): void;\n\n    getVersion(callback: GetVersionCallback): void;\n    getAdapterName(callback: GetAdapterNameCallback): void;\n\n    getCompactSystemConfig(callback: ErrorAsString<ioBroker.GetObjectCallback<'system.config'>>): void;\n    checkFeatureSupported(featureName: string, callback: GenericCallback<boolean>): void;\n\n    sendTo<T = any>(instance: string, command: string, data?: any, callback?: (result: T) => void): void;\n    cmdExec(hostName: string, commandId: number, command: string, callback?: ErrorCallback): void;\n\n    clientSubscribe(\n        targetInstance: string,\n        messageType: string,\n        data: any,\n        callback?: SubscribeOnInstanceCallback,\n    ): void;\n\n    clientUnsubscribe(targetInstance: string, messageType: string, callback?: UnsubscribeFromInstanceCallback): void;\n\n    logout(callback?: ErrorCallback): void;\n\n    log(text: string, level?: string): void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport type AdminListenEvents = {};\n\nexport interface AdminEmitEvents {\n    sendToHost<T = any>(hostname: string, command: string, data?: any, callback?: (result: T) => void): void;\n\n    changePassword(user: string, password: string, callback?: ErrorCallback): void;\n\n    getHostByIp(ipOrHostName: string, callback: GetHostByIPCallback): void;\n\n    encrypt(plaintext: string, callback: GenericCallback<string>): void;\n    decrypt(ciphertext: string, callback: GenericCallback<string>): void;\n\n    chmodFile(\n        adapter: string | null,\n        path: string,\n        options?: { mode: number | string },\n        callback?: ErrorAsString<ioBroker.ChownFileCallback>,\n    ): void;\n    chownFile(\n        adapter: string | null,\n        path: string,\n        options?: { owner?: string; ownerGroup?: string },\n        callback?: ErrorAsString<ioBroker.ChownFileCallback>,\n    ): void;\n\n    restartController(host: string, callback?: (result: '') => void): void;\n\n    getIsEasyModeStrict(callback: GenericCallback<boolean>): void;\n    getEasyMode(\n        callback: GenericCallback<{\n            strict: boolean;\n            configs: any[];\n        }>,\n    ): void;\n\n    // TODO: What's the return type here?\n    getRatings(update: boolean, callback: GenericCallback<any>): void;\n\n    getCurrentInstance(callback: GenericCallback<string>): void;\n    getAdapters(adapterName: string | null | undefined, callback: GenericCallback<ioBroker.AdapterObject[]>): void;\n    getAdapterInstances(\n        adapterName: string | null | undefined,\n        callback: GenericCallback<ioBroker.InstanceObject[]>,\n    ): void;\n    getCompactInstances(callback: GenericCallback<Record<string, CompactInstanceInfo>>): void;\n    getCompactAdapters(callback: GenericCallback<Record<string, CompactAdapterInfo>>): void;\n    getCompactInstalled(host: string, callback: GenericCallbackNoExtraError<CompactInstalledInfo>): void;\n    getCompactRepository(host: string, callback: GenericCallbackNoExtraError<CompactRepository>): void;\n    getCompactHosts(callback: GenericCallback<CompactHost[]>): void;\n    getCompactSystemRepositories(callback: GenericCallback<CompactSystemRepository>): void;\n\n    readLogs(host: string, callback: GenericCallback<LogFile[]>): void;\n    updateLicenses(login: string, password: string, callback: GenericCallback<License[]>): void;\n}\n"]}